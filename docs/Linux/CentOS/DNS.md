## **环境说明**

#### 准备工作

**1. DNS（Domain Name System）系统介绍**

- DNS 系统是一个巨大的树，最上方有一个无名树根，下一层是 arpa,com,edu,gov,int,mil，us, cn。等等，其中 arpa，是域名反解析树的顶端；而 com，edu，等域名本来只用在美国（这就是技术特权啊），但是现在几乎全世界通用；而 us， cn，等叫做国家域。这个树里面的域名并不是统一管理的，网络信息中心（NIS）负责分配顶级域合委派其他制定地区域的授权机构。
- 一个独立管理的 DNS 子树叫做 zone，最常见的区域就是二级域名，比如说.com.cn。我们还可以把这个二级域名给划分成更小的区域，比如说 sina.com.cn。
- DNS 系统是一个分布式的数据库，当一个数据库发现自己并没有某查询所需要的数据的时候，它将把查询转发出去，而转发的目的地通常是根服务器，根服 务器从上至下层层转发查询，直到找到目标为止。DNS 还有一个特点就是使用高速缓存，DNS 把查询过的数据缓存在某处，以便于下次查询时使用。

**2. DNS 协议**

- 最前面的 16 个 bit 唯一的标示了问题号码，用于查询端区别自己的查询。
- 紧接着的 16 个 bit 又可以做进一步的细分，标示了报文的性质和一些细节，比如说是查询报文还是响应报文，需要递归查询与否（一般服务器都支持递归查询，而且不需要任何设置，BIND 就是这样）
- 查询问题后面有查询类型，包括 A，NS，CNAME，PTR，HINFO，MX，如果熟悉 BIND 的话，就知道在 zong 的配置文件里面，每一条记录都记载了各自的类型，比如 A 就是 IP 地址，NS 就是名字服务器。
- 响应报文可以回复多个 IP，也就是说，域名可以和多个 IP 地址对应，并且有很多 CNAME。

**3. 反向查询**

- 正向查询指的是通过域名得到 IP 的查询，而反向查询就是通过 IP 得到域名。例如用 host 命令，host ip 就可以得到服务器的域名，host domainName 就得到 IP。
- 在 DNS 系统里面，一个反向地址对应一个 PTR 纪录（对应 A 纪录），所以反向查询又叫 做指针(PTR)查询。

**4. DNS 服务器高速缓存**

- BIND9 默认是作为一个高速缓存服务器，其将所有的查询都转交到根服务器去，然后得到结果并放在本地的缓冲区，以加快查询速度。如果有兴趣可以安装一个 BIND9 来尝试一下。而自己定义的 zone 则可以规定其在缓存中的时间，一般是 1 天（就是配置文件中的 1D）。

**5. 用 UDP 还是 TCP**

- DNS 服务器支持 TCP 和 UDP 两种协议的查询方式，而且端口都是 53。而大多数的查询都是 UDP 查询的，一般需要 TCP 查询的有两种情况：
- 当查询数据多大以至于产生了数据截断(TC 标志为 1)，这时，需要利用 TCP 的分片能力来进行数据传输（看 TCP 的相关章节）。
- 当主（master）服务器和辅（slave）服务器之间通信，辅服务器要拿到主服务器的 zone 信息的时候。

## **注意事项**
